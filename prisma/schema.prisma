// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE
  FEMALE
}

model Person {
  id        Int       @id @default(autoincrement())
  firstName String
  familyName String
  gender    Gender
  birthDate DateTime?
  deathDate DateTime?
  phone     String?

  fatherId  Int?
  motherId  Int?

  father    Person?   @relation("FatherRelation", fields: [fatherId], references: [id])
  mother    Person?   @relation("MotherRelation", fields: [motherId], references: [id])

  fatherChildren Person[] @relation("FatherRelation")
  motherChildren Person[] @relation("MotherRelation")

  spouseConnections SpouseRelationship[] @relation("PersonToSpouse")
  spousedByConnections SpouseRelationship[] @relation("SpouseToPersons")
}

model SpouseRelationship {
  id              Int         @id @default(autoincrement())
  
  person          Person      @relation("PersonToSpouse", fields: [personId], references: [id])
  personId        Int
  spouse          Person      @relation("SpouseToPersons", fields: [spouseId], references: [id])
  spouseId        Int
  
  startDate       DateTime?
  endDate         DateTime?
  isActive        Boolean     @default(true)
  
  @@unique([personId, spouseId])
}